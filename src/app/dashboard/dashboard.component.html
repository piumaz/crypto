
<form [formGroup]="uiForm" class="md:flex md:flex-row md:gap-6 items-end">

  <div class="mb-2">
    <label>Loop (minutes):</label>
    <input type="number" formControlName="minutes"
           step="0.1" min="0.1" max="5">
  </div>

  <div class="mb-2">
    <label>Service:</label>
    <select formControlName="service">
      <option [ngValue]="null">...</option>
      <option>Coinbase</option>
      <option>CoinbasePro</option>
      <option>CoinGecko</option>
    </select>
  </div>

  <div class="mb-2">
    <label>Symbols:</label>
<!--    <input type="text" formControlName="symbols"/>-->

    <mat-chip-list #symbolList>
      <input
        placeholder="Add symbol..."
        #symbolsInput
        type="text" formControlName="symbols"
        [matAutocomplete]="auto"
        [matChipInputFor]="symbolList">
    </mat-chip-list>
    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectedManagedSymbol($event)">
      <mat-option *ngFor="let symbol of getManagedSymbols()" [value]="symbol">
        {{symbol}}
      </mat-option>
    </mat-autocomplete>

  </div>

  <div class="mb-2">
    <button (click)="start()" [disabled]="!getSelectedManagedSymbols().length" *ngIf="!isStarted">
        <mat-icon>play_circle</mat-icon> <span>START</span>
    </button>

    <button (click)="stop()" *ngIf="isStarted">
      <mat-icon>stop_circle</mat-icon>
      <span style="display: flex; flex-direction: row; align-items: center;">
        STOP
        <mat-spinner *ngIf="isLoading" [diameter]="13" class="ml-2"></mat-spinner>
      </span>
    </button>

    <button (click)="clear()" class="ml-2">
      <mat-icon>remove_circle_outline</mat-icon> <span>CLEAR</span>
    </button>
  </div>

</form>

<div class="my-2">
  <mat-chip
    *ngFor="let symbol of getSelectedManagedSymbols()"
    [selectable]="false"
    [removable]="true"
    (removed)="removeSelectedManagedSymbols(symbol)">
    {{symbol}}
    <mat-icon matChipRemove>cancel</mat-icon>
  </mat-chip>
</div>

<div>
  <div><button (click)="fees()">Fee</button></div>
  <div><button (click)="sell()">Vendi</button></div>
  <div><button (click)="buy()">Compra</button></div>
  <div><button (click)="conversion()">Converti</button></div>
</div>

<app-wallet [results]="accounts$ | async" class="block bg-white shadow overflow-hidden rounded-lg"></app-wallet>

<div *ngIf="controlCheckSymbol.value">
  <h3>I suggest you...</h3>
  <ng-container *ngIf="!messages.length">
    nothing to say for now!
  </ng-container>
  <div *ngFor="let item of messages" class="alert">
    <small>{{item.date | date: 'short'}}</small><br/>
    {{item.message}}
  </div>
</div>

<div *ngIf="historyRows.length" class="my-4">
  <p>
    From {{startedAt | date : 'short'}}, {{historyRows.length}} rows
  </p>
</div>

<div *ngIf="chartData.length" class="rounded-lg ring-1 ring-gray-900 ring-opacity-5 my-4">
  <app-charts style="height:300px"
    type="line"
    legendPosition="right"
    [legend]="false"
    [scheme]="colorScheme"
    [showGridLines]="false"
    [xAxis]="false"
    [yAxis]="false"
    [showXAxisLabel]="false"
    [showYAxisLabel]="false"
    [results]="chartData"></app-charts>
</div>

<div>
  <div id="technical-analysis"></div>
</div>

<div *ngIf="historyRows.length" class="my-4">

  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th *ngFor="let currency of getSymbols(); let i = index" class="px-6 py-3 text-center font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap">
          <div [style.color]="colorScheme.domain[i]"><strong>{{currency}}</strong></div>
          <input type="radio" value="{{currency}}" [formControl]="controlCheckSymbol" class="inline-block">
          <div class="text-xs">
            <!--Average:-->
            {{average[currency]}}<br/>
            <!--Rate:-->
            <span class="rounded-md ring-1 ring-gray-900 ring-opacity-5 px-1" [class.grey]="rate[currency] == 0" [class.green]="rate[currency] > 0" [class.red]="rate[currency] < 0">
              {{rate[currency]}}%
            </span>
          </div>
        </th>
      </tr>
    </thead>

    <tbody class="bg-white divide-y divide-gray-200">
      <tr *ngFor="let item of historyRows; let i = index">
        <td *ngFor="let currency of getSymbols()" class="px-6 py-4 whitespace-nowrap text-right"
            [style.color]="getPriceColor(item[currency], historyRows[i+1]? historyRows[i+1][currency] : item[currency])">

          <span class="price">
          <ng-container [ngSwitch]="getPriceColor(item[currency], historyRows[i+1]? historyRows[i+1][currency] : item[currency])">
            <mat-icon *ngSwitchCase="'red'">arrow_downward</mat-icon>
            <mat-icon *ngSwitchCase="'green'">arrow_upward</mat-icon>
          </ng-container>
          <span>{{item[currency]}}</span>
            </span>
        </td>
      </tr>
    </tbody>
  </table>

</div>
